#!/usr/bin/env python
from __future__ import absolute_import, division, print_function, unicode_literals
import os, sys
project_dir = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))
lib_dir = os.path.join(project_dir, "lib")
sys.path.insert(0, lib_dir)

from config import App
import sys
import git, node, meteor

if len(sys.argv) != 2:
    print("deploy <app-user>")
    sys.exit(255)

app_user = sys.argv[1].strip()

app = App(app_user)
git.update(app)

available_deployers = [meteor, node]
deployers = [deployer for deployer in available_deployers if deployer.detect(app)]

if not deployers:
    print("Cannot start app. Unknown stack type.")
    sys.exit(255)

for deployer in deployers:
    deployer.deploy(app)
